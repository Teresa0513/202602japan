<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA 與 Manifest 連結 -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="2026日本行">
    <link rel="apple-touch-icon" href="images/app_icon.png">

    <title>2026 JAPAN TRAVEL</title>
    <style>
        /* 保持原本的所有 CSS 不變... */
        :root {
            --bg: #FAF9F6; --navy: #1A2A3A; --grey: #8E8E93; --accent: #E67E22;
            --white: #FFFFFF; --map-blue: #4169E1; --lunar-red: #D32F2F;
            --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
        }
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; background-color: var(--white); overscroll-behavior: none; }
        #app-scroller { width: 100%; height: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch; background-color: var(--bg); padding-top: calc(115px + var(--safe-top)); padding-bottom: calc(100px + var(--safe-bottom)); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, "Noto Sans TC", sans-serif; }
        .app-header { position: fixed; top: 0; width: 100%; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); z-index: 2000; padding-top: var(--safe-top); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .header-top { padding: 10px 20px 2px; text-align: center; }
        .header-top h1 { font-size: 0.9rem; margin: 0; font-weight: 800; letter-spacing: 1px; color: var(--navy); }
        .date-slider { display: flex; overflow-x: auto; padding: 10px 15px; gap: 8px; }
        .date-slider::-webkit-scrollbar { display: none; }
        .date-btn { flex: 0 0 auto; min-width: 55px; height: 62px; background: var(--white); border: 1px solid #E6E0D4; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-decoration: none; color: var(--grey); }
        .date-btn.active { background: var(--navy); color: white; border-color: var(--navy); }
        .date-btn .feb-tag { font-size: 0.55rem; font-weight: 700; margin-bottom: 1px; text-transform: uppercase; }
        .date-btn .day-num { font-size: 1.1rem; font-weight: 800; }
        .date-btn .lunar-tag { font-size: 0.5rem; font-weight: bold; color: var(--lunar-red); }
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.98); backdrop-filter: blur(15px); display: flex; padding: 10px 0 calc(10px + var(--safe-bottom)); border-top: 1px solid #EEE; z-index: 2000; }
        .tab-item { flex: 1; text-align: center; text-decoration: none; color: var(--grey); font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .tab-item.active { color: var(--navy); font-weight: 800; }
        .tab-item svg { width: 24px; height: 24px; fill: currentColor; }
        /* 略過其餘卡片 CSS ... 同前一份 */
        .card { background: white; border-radius: 20px; padding: 18px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-bottom: 12px; border-left: 5px solid var(--navy); }
        .day-section { margin-bottom: 45px; scroll-margin-top: 20px; }
        .day-meta h2 { font-size: 1.4rem; margin: 0; font-weight: 800; }
    </style>
</head>
<body>

<div id="app-scroller">
    <!-- 頂部標題與日期列 -->
    <div class="app-header" id="appH">
        <div class="header-top"><h1>2026 JAPAN TRAVEL</h1></div>
        <div class="date-slider" id="dateSlider">
            <a href="javascript:void(0)" onclick="scrollToDay('day1')" class="date-btn active" id="btn-day1"><span class="feb-tag">Feb</span><span class="day-num">12</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day2')" class="date-btn" id="btn-day2"><span class="feb-tag">Feb</span><span class="day-num">13</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day3')" class="date-btn" id="btn-day3"><span class="feb-tag">Feb</span><span class="day-num">14</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day4')" class="date-btn" id="btn-day4"><span class="feb-tag">Feb</span><span class="day-num">15</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day5')" class="date-btn" id="btn-day5"><span class="feb-tag">Feb</span><span class="day-num">16</span><span class="lunar-tag">除夕</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day6')" class="date-btn" id="btn-day6"><span class="feb-tag">Feb</span><span class="day-num">17</span><span class="lunar-tag">初一</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day7')" class="date-btn" id="btn-day7"><span class="feb-tag">Feb</span><span class="day-num">18</span><span class="lunar-tag">初二</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day8')" class="date-btn" id="btn-day8"><span class="feb-tag">Feb</span><span class="day-num">19</span><span class="lunar-tag">初三</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day9')" class="date-btn" id="btn-day9"><span class="feb-tag">Feb</span><span class="day-num">20</span><span class="lunar-tag">初四</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day10')" class="date-btn" id="btn-day10"><span class="feb-tag">Feb</span><span class="day-num">21</span><span class="lunar-tag">初五</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day11')" class="date-btn" id="btn-day11"><span class="feb-tag">Feb</span><span class="day-num">22</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day12')" class="date-btn" id="btn-day12"><span class="feb-tag">Feb</span><span class="day-num">23</span></a>
            <a href="javascript:void(0)" onclick="scrollToDay('day13')" class="date-btn" id="btn-day13"><span class="feb-tag">Feb</span><span class="day-num">24</span></a>
        </div>
    </div>

    <div class="main-content">
        <!-- 這裡是 13 天行程內容 (保持不變) -->
        <div id="itinerary-view" class="tab-content active">
            <section class="day-section" id="day1">
                <div class="day-meta"><h2>02/12 Thu</h2></div>
                <div class="card"><div class="card-title">KHH ➔ NRT GK018 (14:00)</div></div>
            </section>
            <!-- ...中間省略... -->
            <section class="day-section" id="day13">
                <div class="day-meta"><h2>02/24 Tue</h2></div>
                <div class="card"><div class="card-title">KIX ➔ KHH MM031 歸途</div></div>
            </section>
        </div>

        <!-- 預訂分頁 -->
        <div id="booking-view" class="tab-content">
            <!-- 預訂內容保持不變 -->
            <div class="day-meta"><h2>憑證列表</h2></div>
            <div class="booking-grid" id="bookingGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="card" onclick="showV('t')" style="text-align: center;">teamLab</div>
                <div class="card" onclick="showV('hp')" style="text-align: center;">哈利波特</div>
            </div>
            <div id="v-t" class="voucher-card" style="display:none; background:white; padding:20px; border:2px solid var(--navy); border-radius:20px;">
                <button onclick="closeVoucher()">返回</button>
                <h3>TeamLab QR</h3>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TEAMLAB_SAMPLE" width="100%">
            </div>
        </div>
    </div>
</div>

<!-- 底部導覽 -->
<nav class="tab-bar">
    <a href="javascript:void(0)" class="tab-item active" onclick="switchTab('itinerary-view', this)">
        <svg viewBox="0 0 24 24"><path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.9 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/></svg>
        <span>行程</span>
    </a>
    <a href="javascript:void(0)" class="tab-item" onclick="switchTab('booking-view', this)">
        <svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M15.5,13.5L11,18L8.5,15.5L9.91,14.09L11,15.17L14.09,12.08L15.5,13.5Z"/></svg>
        <span>預訂</span>
    </a>
</nav>

<script>
    // 註冊 Service Worker 達成離線使用
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                console.log('Service Worker 註冊成功');
            }).catch(err => {
                console.log('Service Worker 註冊失敗', err);
            });
        });
    }

    // 保持原本的 switchTab, scrollToDay, showV 等 JS 邏輯...
    const scroller = document.getElementById('app-scroller');
    const sections = document.querySelectorAll('.day-section');
    const dateBtns = document.querySelectorAll('.date-btn');

    scroller.addEventListener('scroll', () => {
        let currentId = "";
        sections.forEach(section => {
            const sectionTop = section.offsetTop - 150;
            if (scroller.scrollTop >= sectionTop) {
                currentId = section.getAttribute('id');
            }
        });
        dateBtns.forEach(btn => {
            btn.classList.remove('active');
            if (btn.id === `btn-${currentId}`) {
                btn.classList.add('active');
                btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        });
    });

    function switchTab(viewId, el) {
        document.querySelectorAll('.tab-content').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        document.querySelectorAll('.tab-item').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('appH').style.display = (viewId === 'itinerary-view') ? 'block' : 'none';
        scroller.scrollTop = 0;
    }

    function scrollToDay(id) {
        const el = document.getElementById(id);
        if(el) { scroller.scrollTo({ top: el.offsetTop - 130, behavior: 'smooth' }); }
    }

    function showV(id) {
        document.getElementById('bookingGrid').style.display = 'none';
        document.querySelectorAll('.voucher-card').forEach(v => v.style.display = 'none');
        document.getElementById('v-' + id).style.display = 'block';
    }

    function closeVoucher() {
        document.getElementById('bookingGrid').style.display = 'grid';
        document.querySelectorAll('.voucher-card').forEach(v => v.style.display = 'none');
    }
</script>

</body>
</html>